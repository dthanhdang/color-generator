import{ab as m,ac as T,ad as l,aa as d,j as e,G as y,B as v,a9 as E,ag as N,ah as P,ai as R,aj as b,ak as q,al as C}from"./index-DzOjVrtU.js";import{u as U,a as w,P as F,O as k,i as _,T as O,I,b as M}from"./Page-CGeHKwju.js";import{u as A,s as L,T as n}from"./index-DI6Se_xf.js";import{S as c}from"./Stack-Durp3aim.js";import{C as B,a as D}from"./Title-DAIvk6s8.js";import"./Input-Brqh-TH4.js";import"./InputBase-D4UDrMQ2.js";import"./bundle-mjs-AdmevC4f.js";function p(){return"This field is required"}function V(){const t=p();return m(d(),l(t),T("This e-mail adress is invalid"))}function G(){const t=p();return m(d(),l(t))}function Q({defaultEmail:t,onSubmit:a}){const s=A({initialValues:{email:t??"",firstName:"",lastName:""},mode:"uncontrolled",validate:L(W())}),i=s.onSubmit(a);return e.jsx("form",{onSubmit:i,children:e.jsxs(c,{className:"gap-5",children:[e.jsx(n,{...s.getInputProps("firstName"),autoCorrect:"given-name",autoFocus:!0,label:"First name :",name:"firstName",placeholder:"e.g. Jane",withAsterisk:!0}),e.jsx(n,{...s.getInputProps("lastName"),autoComplete:"family-name",label:"Last name :",name:"lastName",placeholder:"e.g. Doe",withAsterisk:!0}),e.jsx(n,{...s.getInputProps("email"),autoComplete:"email",label:"E-mail address :",name:"email",placeholder:"e.g. jane.doe@gmail.com",withAsterisk:!0}),e.jsx(y,{justify:"flex-end",mt:"md",children:e.jsx(v,{type:"submit",children:"Request a verification code"})})]})})}function W(){const t=V(),a=G();return E({email:t,firstName:a,lastName:a})}function J(){const t=N();return U({mutationFn:P,onSuccess:()=>t.invalidateQueries({queryKey:["CURRENT_USER"]})}).mutateAsync}function K({email:t,role:a}){const{formData:s,handleResendOTP:i,handleSubmit:g}=w({requestOTP:q}),h=R(),x=J(),{storeUser:f}=b(),o=s?async({code:j})=>{const r=await x({...s,...a==="administrator"?{role:"administrator"}:{},code:j});if("idToken"in r){const{idToken:S}=r,u=_(S);u&&(await f(u),await h({to:"/"}))}else switch(r.error){case"administrator_already_exists":return e.jsx(M,{children:"There's already an administrator"});case"invalid_or_expired_code":return e.jsx(I,{});case"user_already_exists":return e.jsxs("p",{children:["You already have an account. Would you rather"," ",e.jsx(O,{search:{email:s.email,role:a==="administrator"?a:void 0},to:"/auth/sign-in",children:"sign-in ?"})]})}}:void 0;return e.jsx(F,{displayTitle:!1,children:e.jsx(B,{className:"mx-2 my-auto lg:mx-auto lg:w-2/5",component:"main",padding:"lg",radius:"md",shadow:"sm",withBorder:!0,children:e.jsxs(c,{gap:20,children:[e.jsx(D,{className:"text-center",order:1,children:a==="administrator"?"Sign-up as administrator":"Sign-up"}),o&&s?e.jsx(k,{email:s.email,onResendCode:i,validateCode:o}):e.jsx(Q,{defaultEmail:t,onSubmit:g})]})})})}const se=function(){const{email:a,role:s="registered_user"}=C.useSearch();return e.jsx(K,{email:a,role:s})};export{se as component};
