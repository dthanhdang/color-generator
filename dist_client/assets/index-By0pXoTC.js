import{a9 as h,j as e,G as x,B as f,ab as j,am as S,ac as T,aa as b,ag as v,an as y,ai as C,ak as P,aj as I,ao as R}from"./index-DzOjVrtU.js";import{u as w,a as _,P as k,O as E,i as O,T as q,I as F}from"./Page-CGeHKwju.js";import{u as N,s as L,T as U}from"./index-DI6Se_xf.js";import{C as A,a as B}from"./Title-DAIvk6s8.js";import{S as D}from"./Stack-Durp3aim.js";import"./Input-Brqh-TH4.js";import"./InputBase-D4UDrMQ2.js";import"./bundle-mjs-AdmevC4f.js";const G=h({email:j(b(),T("Cette adresse e-mail ne semble pas valide"),S(1,"Ce champ est obligatoire"))});function M({defaultEmail:t,onSubmit:s}){const a=N({initialValues:{email:t??""},mode:"uncontrolled",validate:L(G)}),i=a.onSubmit(s);return e.jsxs("form",{"data-testid":"email-form",onSubmit:i,children:[e.jsx(U,{autoComplete:"email",autoFocus:!0,"data-testid":"email-input",label:"E-mail :",name:"email",placeholder:"e.g. jane.doe@gmail.com",withAsterisk:!0,...a.getInputProps("email")},a.key("email")),e.jsx(x,{className:"justify-end",mt:"md",children:e.jsx(f,{"data-testid":"submit-button",type:"submit",children:"Request a verification code"})})]})}function Q(){const t=v();return w({mutationFn:y,onSuccess:()=>t.invalidateQueries({queryKey:["CURRENT_USER"]})}).mutateAsync}function V({email:t,redirectTo:s,role:a}){const i=C(),u=Q(),{formData:n,handleResendOTP:d,handleSubmit:c}=_({requestOTP:P}),{storeUser:l}=I(),r=n?async({code:p})=>{const o=await u({...n,...a==="administrator"?{role:a}:{},code:p});if("idToken"in o){const{idToken:g}=o,m=O(g);m&&(await l(m),await i({to:s??"/"}))}else switch(o.error){case"invalid_or_expired_code":return e.jsx(F,{});case"user_does_not_exist":return e.jsxs("p",{children:["You don't have an account yet, would you rather"," ",e.jsx(q,{search:{email:n.email,role:a==="administrator"?a:void 0},to:"/auth/sign-up",children:"sign-up ?"})," ?"]})}}:void 0;return e.jsx(k,{displayTitle:!1,children:e.jsx(A,{className:"m-auto lg:w-2/5",padding:"lg",radius:"md",shadow:"sm",withBorder:!0,children:e.jsxs(D,{gap:20,children:[e.jsx(B,{className:"text-center",order:1,children:a==="administrator"?"Sign-in as Administrator":"Sign-in"}),n&&r?e.jsx(E,{email:n.email,onResendCode:d,validateCode:r}):e.jsx(M,{defaultEmail:t,onSubmit:c})]})})})}const ee=function(){const{email:s,redirect_to:a,role:i="registered_user"}=R.useSearch();return e.jsx(V,{email:s,redirectTo:a,role:i})};export{ee as component};
